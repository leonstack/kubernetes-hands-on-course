<?xml version="1.0" encoding="UTF-8"?>
<svg width="950" height="750" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .hpa-box {
        fill: #ff9999;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .metrics-server-box {
        fill: #66cc99;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .deployment-box {
        fill: #4a6741;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .replicaset-box {
        fill: #4a6741;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .pod-box {
        fill: #66cccc;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .kubelet-box {
        fill: #9966cc;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .cadvisor-box {
        fill: #cc9966;
        stroke: none;
        rx: 8;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
      }
      .node-box {
        fill: #cccccc;
        stroke: #999999;
        stroke-width: 2;
        rx: 8;
        fill-opacity: 0.3;
      }
      .text-white {
        font-family: Arial, sans-serif;
        font-size: 14px;
        font-weight: bold;
        text-anchor: middle;
        fill: white;
      }
      .text-black {
        font-family: Arial, sans-serif;
        font-size: 12px;
        text-anchor: middle;
        fill: #333;
      }
      .text-small {
        font-family: Arial, sans-serif;
        font-size: 10px;
        text-anchor: middle;
        fill: #333;
      }
      .arrow {
        stroke: #333;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .metrics-arrow {
        stroke: #66cc99;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead-green);
      }
      .control-arrow {
        stroke: #cc0000;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead-red);
      }
      .api-arrow {
        stroke: #ff9900;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead-orange);
      }
      .data-arrow {
        stroke: #9966cc;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead-purple);
      }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#66cc99" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#cc0000" />
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ff9900" />
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#9966cc" />
    </marker>
  </defs>

  <!-- Background -->
  <rect width="950" height="750" fill="#f0f8ff"/>

  <!-- 标题 -->
  <text x="475" y="30" class="text-black" style="font-size: 18px; font-weight: bold; text-anchor: middle;">Kubernetes HPA 资源指标架构图</text>

  <!-- Horizontal Pod Autoscaler -->
  <rect x="100" y="60" width="200" height="60" class="hpa-box"/>
  <text x="200" y="95" class="text-white">Horizontal Pod Autoscaler</text>

  <!-- Metrics Server -->
  <rect x="550" y="60" width="150" height="60" class="metrics-server-box"/>
  <text x="625" y="95" class="text-white">Metrics Server</text>

  <!-- Deployment -->
  <rect x="140" y="180" width="120" height="60" class="deployment-box"/>
  <text x="200" y="215" class="text-white">Deployment</text>

  <!-- Replica Set -->
  <rect x="140" y="280" width="120" height="60" class="replicaset-box"/>
  <text x="200" y="315" class="text-white">Replica Set</text>

  <!-- Node 1 -->
  <rect x="50" y="420" width="350" height="280" class="node-box"/>
  <text x="225" y="440" class="text-black" style="font-weight: bold;">Node 1</text>

  <!-- Node 1 - PODs -->
  <rect x="70" y="470" width="80" height="50" class="pod-box"/>
  <text x="110" y="500" class="text-white">POD</text>

  <rect x="170" y="470" width="80" height="50" class="pod-box"/>
  <text x="210" y="500" class="text-white">POD</text>

  <rect x="270" y="470" width="80" height="50" class="pod-box"/>
  <text x="310" y="500" class="text-white">POD</text>

  <!-- Node 1 - kubelet -->
  <rect x="70" y="580" width="100" height="50" class="kubelet-box"/>
  <text x="120" y="610" class="text-white">kubelet</text>

  <!-- Node 1 - cAdvisor -->
  <rect x="190" y="580" width="100" height="50" class="cadvisor-box"/>
  <text x="240" y="610" class="text-white">cAdvisor</text>

  <!-- Node 1 - 节点资源监控说明 -->
  <text x="310" y="610" class="text-small">节点资源监控</text>

  <!-- Node 2 -->
  <rect x="450" y="420" width="350" height="280" class="node-box"/>
  <text x="625" y="440" class="text-black" style="font-weight: bold;">Node 2</text>

  <!-- Node 2 - PODs -->
  <rect x="470" y="470" width="80" height="50" class="pod-box"/>
  <text x="510" y="500" class="text-white">POD</text>

  <rect x="570" y="470" width="80" height="50" class="pod-box"/>
  <text x="610" y="500" class="text-white">POD</text>

  <rect x="670" y="470" width="80" height="50" class="pod-box"/>
  <text x="710" y="500" class="text-white">POD</text>

  <!-- Node 2 - kubelet -->
  <rect x="470" y="580" width="100" height="50" class="kubelet-box"/>
  <text x="520" y="610" class="text-white">kubelet</text>

  <!-- Node 2 - cAdvisor -->
  <rect x="590" y="580" width="100" height="50" class="cadvisor-box"/>
  <text x="640" y="610" class="text-white">cAdvisor</text>

  <!-- Node 2 - 节点资源监控说明 -->
  <text x="710" y="610" class="text-small">节点资源监控</text>

  <!-- Arrows and Labels -->
  
  <!-- HPA to Metrics Server -->
  <line x1="300" y1="90" x2="550" y2="90" class="api-arrow"/>
  <text x="425" y="80" class="text-black">metrics.k8s.io/v1beta1</text>

  <!-- HPA to Deployment -->
  <line x1="200" y1="120" x2="200" y2="180" class="control-arrow"/>
  <text x="220" y="150" class="text-small">扩缩容控制</text>

  <!-- Deployment to Replica Set -->
  <line x1="200" y1="240" x2="200" y2="280" class="arrow"/>

  <!-- Replica Set to PODs using direct lines from center bottom -->
  <!-- All lines start from Replica Set center bottom (200, 340) -->
  <line x1="200" y1="340" x2="110" y2="470" class="arrow"/>
  <line x1="200" y1="340" x2="210" y2="470" class="arrow"/>
  <line x1="200" y1="340" x2="310" y2="470" class="arrow"/>
  <line x1="200" y1="340" x2="510" y2="470" class="arrow"/>
  <line x1="200" y1="340" x2="610" y2="470" class="arrow"/>
  <line x1="200" y1="340" x2="710" y2="470" class="arrow"/>

  <!-- PODs to cAdvisor (data collection) using direct lines -->
  <!-- Node 1 -->
  <line x1="110" y1="520" x2="240" y2="580" class="data-arrow"/>
  <line x1="210" y1="520" x2="240" y2="580" class="data-arrow"/>
  <line x1="310" y1="520" x2="240" y2="580" class="data-arrow"/>

  <!-- Node 2 -->
  <line x1="510" y1="520" x2="640" y2="580" class="data-arrow"/>
  <line x1="610" y1="520" x2="640" y2="580" class="data-arrow"/>
  <line x1="710" y1="520" x2="640" y2="580" class="data-arrow"/>

  <!-- cAdvisor to kubelet (data aggregation) -->
  <line x1="190" y1="605" x2="170" y2="605" class="data-arrow"/>
  <line x1="590" y1="605" x2="570" y2="605" class="data-arrow"/>

  <!-- Metrics Server to kubelet using polylines from right side (moved 100px right) -->
  <!-- 修正箭头方向：从 Metrics Server 指向 kubelet -->
  <polyline points="700,90 850,90 850,650 120,650 120,630" class="metrics-arrow"/>
  <text x="850" y="370" class="text-small" style="text-anchor: middle; transform: rotate(90deg); transform-origin: 850px 370px;">获取资源指标</text>

  <polyline points="700,100 870,100 870,670 520,670 520,630" class="metrics-arrow"/>

  <!-- 数据流说明 - 移到中间空白区域 -->
  <g transform="translate(550, 250)">
    <rect x="-120" y="-40" width="240" height="130" fill="white" stroke="#ddd" stroke-width="1" rx="5"/>
    <text x="0" y="-20" class="text-black" style="font-size: 16px; font-weight: bold; text-anchor: middle;">数据流程说明</text>
    <text x="-100" y="-2" class="text-small" style="font-size: 13px; text-anchor: start;">1. cAdvisor 收集容器资源使用情况</text>
    <text x="-100" y="16" class="text-small" style="font-size: 13px; text-anchor: start;">2. kubelet 聚合节点资源指标</text>
    <text x="-100" y="34" class="text-small" style="font-size: 13px; text-anchor: start;">3. Metrics Server 收集并暴露指标</text>
    <text x="-100" y="52" class="text-small" style="font-size: 13px; text-anchor: start;">4. HPA 查询并决策扩缩容</text>
  </g>

  <!-- 图例说明 - 移到底部中央 -->
  <g transform="translate(300, 720)">
    <!-- HPA 控制流 -->
    <line x1="0" y1="0" x2="20" y2="0" class="control-arrow"/>
    <text x="25" y="4" class="text-small" style="text-anchor: start;">HPA 控制</text>
    
    <!-- API 调用 -->
    <line x1="100" y1="0" x2="120" y2="0" class="api-arrow"/>
    <text x="125" y="4" class="text-small" style="text-anchor: start;">API 调用</text>
    
    <!-- 指标收集 -->
    <line x1="200" y1="0" x2="220" y2="0" class="metrics-arrow"/>
    <text x="225" y="4" class="text-small" style="text-anchor: start;">指标收集</text>
    
    <!-- 数据流 -->
    <line x1="300" y1="0" x2="320" y2="0" class="data-arrow"/>
    <text x="325" y="4" class="text-small" style="text-anchor: start;">数据流</text>
    
    <!-- 管理关系 -->
    <line x1="380" y1="0" x2="400" y2="0" class="arrow"/>
    <text x="405" y="4" class="text-small" style="text-anchor: start;">管理关系</text>
  </g>

</svg>